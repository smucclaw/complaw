\section{An Overview of the L4 Language}\label{sec:l4_language}

This section gives an account of the L4 language as it is currently defined --
as an experimental language, L4 will evolve over the next months. In our
discussion, we will ignore some features such as a natural language interface
\cite{listemnmaa2021cnl} which are not relevant for the topic of this paper but are relevant in the future.

As a language intended for representing legal texts and reasoning about them,
an L4 module is essentially composed of four sections:
\begin{itemize}
\item a terminology in the form of \emph{class definitions};
\item \emph{declarations} of functions and predicates;
\item \emph{rules} representing the core of a law text, specifying what is
  considered as legal behaviour;
\item \emph{assertions} for stating and proving properties about the rules.
\end{itemize}

In the following, these elements will be presented in more detail and
illustrated with an example, a (fictitious) regulation of speed
limits for different types of vehicles.


% ----------------------------------------------------------------------
\subsection{Rules}\label{sec:rules}

Before discussing rules, a few remarks about \emph{expressions} which are
their main constituents: L4 supports a simple functional language featuring
typical arithmetic, Boolean and comparison operators, an \texttt{if .. then
  .. else} expression, function application, anonymous functions (\ie, lambda
abstraction) written in the form \texttt{$\backslash$x : T -> e}, class
instances and field access (as mentioned before). A \emph{formula} is just a
Boolean expression, and, consequently, so are quantified formulas
\texttt{forall x:T. form} and \texttt{exists x:T. form}.

In its most complete form, a \emph{rule} is composed by a list of variable
declarations introduced by the keyword \texttt{for}, a precondition introduced
by \texttt{if} and a postcondition introduced by
\texttt{then}. \figref{fig:rules} gives an example of rules of our speed limit
scenario, stating, respectively, that the maximal speed of cars is 90 km/h on a
workday,\remms{scenario changed wrt repo}
and that they may drive at 130 km/h if the road is a highway.  Note that in
general, both pre- and postconditions are Boolean formulas that can be
arbitrarily complex, thus are not limited to conjunctions of literals in the
preconditions or atomic formulas in the postconditions.

\begin{figure}[h!]
%\begin{mdframed}

  \begin{lstlisting}
rule <maxSpCarWorkday> 
   for v: Vehicle, d: Day, r: Road
   if isCar v && isWorkday d
   then maxSp v d r 90

rule <maxSpCarHighway>
   for v: Vehicle, d: Day, r: Road
   if isCar v && isHighway r
   then maxSp v d r 130
\end{lstlisting}

%\end{mdframed}
  \caption{Rules of speedlimit example}\label{fig:rules}
\end{figure}

Rules whose precondition is \texttt{true} can be written as

\begin{lstlisting}[frame=none,mathescape=true]
fact <name> for $v_1$: $T_1$ $\dots$ $v_n$: $T_n$ P $v_1 \dots v_n$
\end{lstlisting}

Rules may not contain free variables, so all variables occuring in the body of
the rule have to be declared in the \texttt{for} clause. In the absence of
variables to be declared, the \texttt{for} clause can be omitted.

Intuitively, a rule

\begin{lstlisting}[frame=none,mathescape=true]
  rule <r> for $\overrightarrow{v}$: $\overrightarrow{T}$ if Pre $\overrightarrow{v}$ then Post $\overrightarrow{v}$
\end{lstlisting}
corresponds to a universally quantified formula
$\forall \overrightarrow{v} : \overrightarrow{T}.\; Pre \overrightarrow{v}
\IMPL Post \overrightarrow{v}$ that could directly be written as a fact,
and it may seem that a separate rule syntax is redundant. This is not so,
because the specific structure of rules makes them amenable to transformations
that are useful for defeasible reasoning, as will be seen in \secref{sec:defeasible}.

Apart from user-defined rules and rules obtained by transformation, there are
system generated rules: For each subclass relation \texttt{$C$ extends $B$}, a
class inclusion axiom of the form \texttt{for x: $S$ if is$C$ x then is$B$ x}
is generated, where \texttt{is$C$} and \texttt{is$B$} are the characteristic
predicates and $S$ is the common supersort of $C$ and $B$.\remms{Promise}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
