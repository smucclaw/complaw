\section{Proof simplification using User Provided Facts}\label{sec:proof_simplification}
\begin{definition}[Abstract Proof Graph]
Given a rule set $R$ which does not contain NAF, a predicate $p$ and integer $n$ define the abstract proof graph
$G_{R,p,n}$ as follows. The nodes of $G_{R,p,n}$ is the set of $query$
predicates generated by the rules just by the rules $AG1$ and $AG3$, in the encoding $P_{\langle R,q,U,C,N\rangle}^{res}$ where in
$\langle R,q,U,C,N\rangle$, $q$ is $p(v1,v2..,vk)$ assuming $p$ has arity $k$,
$U$, $C$ are empty and $N = n$. The edge relation is defined as follows. Two
nodes $d1$, $d2$ are connected by a directed edge represented as $E(d1,d2)$ if
and only if, $d1$ represents a pre-condition of an input rule where $d2$ is
the post condition.
\end{definition}
So if $R'$ consisted to the rules:
\begin{lstlisting}[frame=none]
a(X):-b(X,Y),c(Y).
b(X,Y):-d(X,Y,Z).
\end{lstlisting}
Then $G_{R',a,2}$ is:
\begin{lstlisting}[frame=none]
E(query(b(v1,sk(v1)),1),query(a(v1),0)),
E(query(c(sk(v1)),1),query(a(v1),0)))
E(query(d(v1,sk(v1),sk'(v1,sk(v1))),2),query(b(v1,sk(v1)),1))
\end{lstlisting}
Here $sk$ $sk'$ are just abbreviations of the full skolem function names. Also we assume the order $[X,Y,Z]$ on variables in the second rule, and the order $[X,Y]$ on variables in the first rule. (Recall that when defining the abducible generation rules in section 3 we had an order on variables in a rule)
\begin{definition}[Abstract Instance Set]\label{absinst}
Given a rule set $R$, predicate $p$ and integer $n$, the corresponding Abstract Instance Set denoted corresponding to this triple denoted by  $I_{R,p,n}$ is the set of $create\_Sub$
predicates generated by the rules just by the rules $AG1$ and $AG3$, in the encoding $P_{\langle R,q,U,C,N\rangle}^{res}$ where in
$\langle R,q,U,C,N\rangle$, $q$ is $p(v1,v2..,vk)$ assuming $p$ has arity $k$,
$U$, $C$ are empty and $N = n$. 
\end{definition}
So for the example above the set $I_{R',a,2}$ is:\\ $createSub(subInst\_r1(v1,sk(v1)),1)$,\\ $createSub(subInst\_r2(v1,sk(v1), sk'(v1,sk(v1))),2)$ 

\begin{definition}[Minimal abstract Proof Graph]\label{minabsgraph}
Given an abstract proof graph $G_{R',p,N}$, construct the minimal proof graph $G_{R',p,N}^{min}$ as follows. Firstly for given an integer $k$, going from left to right, delete all duplicate nodes $query(a',k)$ such that $query(a,k)$ is already in the proof graph and $a'=a$. Next for going down the proof graph, for each $k\in {0,1...,N}$, delete the node $query(a,k)$, if there exists $l<k$, such that $query(a',l)$ is in the proof graph $a=a'$. This forms $G_{R',p,N}^{min}$. The edge relation is inherited from $G_{R,p,N}$ in the obvious way. 
\end{definition}
Note firstly that if for some $b,j$, $query(b,j)$ is in $G_{R',p,N}$, then there exists some $h\leq j$ such that $query(b,h)$ is in $G_{R',p,N}^{min}$. Secondly we have the following property:
\begin{lemma}
Given $query(a,k)$ in $G_{R',p,N}^{min}$, unless $k=0$, there exists $query(a',k-1)$ in $G_{R',p,N}^{min}$ such that we have 

$E(query(a,k),query(a',k-1))$.  
\end{lemma}


\begin{proof} \textit{(sketch)}. \\
Let $query(a'',k-1)$ be such that $E(query(a,k),query(a'',k-1))$ is an edge of $G_{R',p,N}$. Now if $query(a'',k-1)$ is not in $G_{R',p,N}^{min}$, then there exists $s<k-1$ such that $query(a'',s)$ is in $G_{R',p,N}^{min}$. Therefore $query(a'',s)$ is in $G_{R',p,N}$. Then it follows that $query(a,s+1)$ is in $G_{R',p,N}$. However this is a contradiction since $s+1<k$. Hence it must be the case that $query(a'',k-1)$ is in $G_{R',p,N}^{min}$. 
\end{proof}

For the example we have been considering, the minimal abstract proof graph is the same as the abstract proof graph.

\begin{definition}[Concrete Proof Graph]\label{def:concretegraph}
Given a minimal abstract proof graph $G_{R,p,n}^{min}$, and a substitution $\theta$ for
terms in the minimal abstract proof graph, define the concrete proof graph
$C_{R,p,n,\theta}$ to be the set of $query$ atoms obtained after doing the
substitution $\theta$ on the set of $query$ atoms in $G_{R,p,n}^{min}$. (We drop the $min$ from the notation for the concrete proof graph as we will always mean a substitution from the minimal abstract proof graph)
\end{definition}

Note that such a substitution $\theta$ need not be injective.

\begin{definition}[Parent node, child node, sibling node, descendant]
Given any concrete or abstract, minimal or non minimal proof graph $G$ and given two nodes $d1,d2$ in $G$, we say that $d2$ is a $\textit{parent}$ of $d1$ if we have $E(d1,d2)$. In such a case we say $d1$ is a $\textit{child}$ of $d2$. Given two nodes $d3$ and $d4$, we say $d3$ is a $\textit{sibling}$ node of $d4$, if there exists some node $d'$ such that $E(d3,d')$ and $E(d4,d')$. ($d4$ is then also a sibling node of $d3$) Given two nodes $d5$ and $d6$, we say $d5$ is a $\textit{descendant}$ of $d6$ if $E_{tr}(d5,d6)$ is true where $E_{tr}$ is the transitive closure of $E$. 
\end{definition}

\begin{definition}[Concrete Instance Set]
Given an abstract instance set $I_{R,p,n}$, and a substitution $\theta$ for
terms in the instance set, define the concrete instance set
$I_{R,p,n,\theta}$ to be the set of $createSub$ atoms obtained after applying the
substitution $\theta$ on the set of $createSub$ atoms in $I_{R,p,n}$, (which itself is associated to the full abstract proof graph rather than the minimal one).
\end{definition}

For our example consider the substitution $\theta =[v1\rightarrow john,sk(v1) \rightarrow extVar, sk'(v1,sk(v1))\rightarrow extVar]$. Then $C_{R',a,2,\theta}$ is :
\begin{lstlisting}[frame=none]
E(query(b(john,extVar),1),query(a(john),0)),
E(query(c(extVar),1),query(a(john),0)))
E(query(d(john,extVar,extVar),2),query(b(john,extVar),1))
\end{lstlisting}
$I_{R,p,n,\theta}$ = $createSub(subInst\_r1(john,extVar),1)$,\\ $createSub(subInst\_r2(john,extVar, extVar),2)$

\begin{definition}[Derived Substitution - T ]\label{def:derivesub}
Given some $G_{R,p,n}^{min}$, and an associated $C_{R,p,n,\theta}$, let $q_{c}$ be a $query$ atom from $C_{R,p,n,\theta}$. Let $S_{q_{c}}$ be the set of $query$ atoms in $G_{R,p,n}^{min}$, which upon application of the substitution $\theta$ give $q_{c}$. Now pick an atom $q_{o}$ from $S_{q_{c}}$. Now suppose $q_{c}$ is given by $query((t_{1},t_{2},...,t_{j}),k)$, $q_{o}$ is given by $query((e_{1},e_{2},...,e_{j}),k)$. Now consider an arbitrary query atom $q_{f}$ given by $query((a_{1},a_{2},...,a_{j}),k)$, which is such that the map $\psi$ mapping each $e_{i}$ to the corresponding $a_{i}$ is well defined. (ie. $\psi$ is not one-to-many). Then define the substituion $\phi = T(\theta, q_{c},q_{o},q_{f})$ on terms in $G_{R,p,n}^{min}$ by the following:\\ For a term $u$ in $G_{R,p,n}^{min}$ (meaning $u$ occurs as the argument of the predicate inside some $query$ atom), if $u$ is in the set $\{e_{1},e_{2},...,e_{j}\}$ then $\phi(u) = \psi(u)$, otherwise $\phi(u) = \theta(u)$.
\end{definition}
For instance going back to our example if we let $q_{c}$ be\\
$query(b(john,extVar),1)$ let $q_{o}$ be $query(b(v1,sk(v1)),1)$ and let $q_{f}$ be $query(b(john,james),1)$ then $\phi=T(\theta,q_{c},q_{o},q_{f})$ is the substitution $\theta =[v1\rightarrow john,sk(v1) \rightarrow james, sk'(v1,sk(v1))\rightarrow extVar]$. We now have the following theorem:

\begin{theorem}[Term substitution]\label{thm:termsub}
Consider the abductive proof generation task $\langle R,q,U,C,N\rangle$, and suppose that his task is a simple abductive proof generation task. Let $p$ be the predicate corresponding to $q$. Suppose $A$ is an answer set of $P^{semi-res}_{<R,q,U,C,N>}$ and let $A$ contain $C_{R,p,N,\theta}$ and $I_{R,p,N,\theta}$ . Now
say the atom $q_{c}$ $query(p_{i}(t_{1},t_{2},..,t_{j}),k)$ is in
$C_{R,p,N,\theta}$. Let $q_{o}$ be some query atom from the set $S_{q_{c}}$
given by $query((e_{1},e_{2},...,e_{j}),k)$. Now suppose, $q_{f}=
query((a_{1},a_{2},...,a_{j}),k)$ is an arbitrary $query$ atom such that the
map $\psi$ from the $e_{i}s$ to the $a_{i}s$ as described in the definition
above is well defined. Then upon adding the fact
$query(p_{i}(a_{1},a_{2},..,a_{j}),k)$ to $P^{semi-res}_{<R,q,U,C,N>}$,
the resulting program has an answer set $A'$ such that $A'$ contains
$C_{R,p,N,\phi}$ and $I_{R,p,N,\phi}$  where $\phi = T(\theta, q_{c}, q_{o}, q_{f})$
\end{theorem} 

The proof can found in [airxiv ref]


%\input{derivation_tree_figure}


\begin{corollary}[Adding facts]\label{thm:addfact}
Given the simple abductive proof generation task $\langle R,q,U,C,N\rangle$, let $p$ be the predicate corresponding to $q$. Suppose $A$ is an answer set of $P^{semi-res}_{<R,q,U,C,N>}$ and let $A$ contain $C_{R,p,N,\theta}$ and $I_{R,p,N,\theta}$. Now say the atom $q_{c}$ $query(p_{i}(t_{1},t_{2},..,t_{j}),k)$ is in $C_{R,p,N,\theta}$. Let $q_{o}$ be some query atom from the set $S_{q_{c}}$ (The set of pre-images of $q_{c}$ in $G_{R,p,N}^{min}$) given by $query((e_{1},e_{2},...,e_{j}),k)$. Now suppose, $h_{f}= holds((a_{1},a_{2},...,a_{j}))$ is an arbitrary $holds$ atom such that the map $\psi$ from the $e_{i}s$ to the $a_{i}s$ as described in the earlier definition of derived substitution is well defined. Then upon adding the fact $holds(p_{i}(a_{1},a_{2},..,a_{j}))$ to $P^{semi-res}_{<R,q,U,C,N>}$, the resulting program has an answer set $A'$ such that $A'$ contains $C_{R,p,N,\phi}$ and $I_{R,p,N,\phi}$ , where $\phi = T(\theta, q_{c}, q_{o}, q_{f})$, where $q_{f} = query(p_{i}(a_{1},a_{2},..,a_{j}),k)$. 
\end{corollary}

The proof can found in [airxiv ref]



The preceding theorem and corrolary correspond to the notion of full implicit term substitution which we discussed earlier. For example going to our main example in this section. Let $R$ be the set of rules:\begin{lstlisting}[frame=none]
a(X):-b(X,Y),c(Y).
b(X,Y):-d(X,Y,Z).
\end{lstlisting}

Let $q$ be $a(john)$, let the set of user provided facts be empty and suppose that no instances of the predicate $a$ or $b$ can be abduced. Finally suppose that the set $C$ is empty and $N=2$. Then upon running the ASP program $P_{\langle R,q,U,C,N\rangle}^{semi-res}$ we will get the minimal abductive solution \begin{lstlisting}[frame=none]
abducedFact(c(extVar)), abducedFact(d(john,extVar,extVar))
\end{lstlisting} 
This corresponds to the substitution $\theta =[v1\rightarrow john,sk(v1) \rightarrow extVar, sk'(v1,sk(v1))\rightarrow extVar]$. Then upon modifying the set of user provided facts by adding the fact $c(james)$, we get the smaller abductive solution:
\begin{lstlisting}[frame=none]
abducedFact(d(john,james,extVar))
\end{lstlisting} which corresponds to the substitution $\theta =[v1\rightarrow john,sk(v1) \rightarrow james, sk'(v1,sk(v1))\rightarrow extVar]$. 

% \section{Summary of results - II}
As was the case for the finiteness and completeness results, it is in fact the case the theorem and corollary proved in the previous section hold for the slightly larger class of abductive proof generation tasks which we called semi-simple. Overall, we have the following results. Given a semi-simple task $\langle R,q,U,\emptyset,N\rangle$, if no rule in $R$ contains existential variables, then to solve this task we can use the encoding $P_{\langle R,q,U,\emptyset,N\rangle}^{exp}$, which enjoys the completeness, finiteness and full term substitution properties. If $R$ does contain existential variables then we can either use the encoding $P_{\langle R,q,U,\emptyset,N\rangle}^{res}$ which enjoys the properties of completeness and finiteness but only gives us partial term substitution or we can use $P_{\langle R,q,U,\emptyset,N\rangle}^{semi-res}$ which enjoys the properties of completeness, finiteness and full term substitution. 



%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
